# 要件定義

## 目的と概要

- 某コミュニティーのメンバーが、ハンドルネームを口座名義にして簡単な口座を作成し銀行のコアの処理を使って遊べるようなシステムの実装

## 機能一覧

以下のフォーマットで記載する

```
- 大分類
  - 機能 1
    - 概要
  - 機能 2
    - 概要
```

- 口座管理機能
  - 口座作成
    - 新規口座を発行する。初期残高は 0 円のみを考慮すれば良い
    - 口座番号は 6 桁のランダムな数字に
- 取引機能
  - 入金
    - 指定された金額 X(JPY)を指定された口座 A に入金する
    - 口座 A の残高が X(JPY)増える
  - 出金
    - 指定された金額 X(JPY)を指定された口座 A から引き落とす
    - 口座 A の残高が X(JPY)減る
  - 残高照会
    - 指定された口座 A の現在の残高(JPY)を取得する
  - 振替: 口座 A から口座 B へ指定された金額 X(JPY)を移動
    - 双方の口座にロックをかけて排他処理する
    - 口座 A の残高が X(JPY)減る
    - 口座 B の残高が X(JPY)増える
    - 処理が成功した場合口座 A の残高を返す
    - 成功した場合口座 A の残高を返す
- 仕訳、照会機能
  - 取引履歴照会
    - 指定された口座 A の仕訳処理をした結果の台帳を照会できる
    - 期間は絞らない
    - ページングもしない
    - 最大 1000 件

## その他条件

- 通貨単位は JPY 固定
- 口座番号は
- 台帳は追記型で、登録済み n の訳は変更不可。
- 残高不足の場合は出金・振替など貸方の処理を拒否

### 作らないもの

- 詳細な名義人情報の保持
- ログイン、認証機能
- 支店は扱わない
- 画面(UI)
  - 後付けで実装する可能性はある

## 非機能要件

- すべての処理はアトミック性を担保すること
- オーバーエンジニアリングを許容する

## システム要件

- 言語
  - Scala
- DB
  - PostgreSQL
- フレームワーク、ライブラリ
  - pekko-http
  - pekko-actor-typed
- 単体テスト
  - MUnit

## API 概要

- HTTPS REST API
- Content-Type: JSON（UTF-8）
- 詳細な仕様は api.md を参照
